# Алгоритм агрегации статистических данных о зарплатах сотрудников

Проект предоставляет:
1. **FastAPI** для агрегации зарплат по периодам
2. **Telegram-бота** для удобного взаимодействия с API

## Установка (Linux)
1. Клонирование репозитория

```bash
git clone https://github.com/Kristina-Rozhkova/Algorithm_for_employee_salaries.git
```

2. Переход в директорию Algorithm_for_employee_salaries

```bash
cd Algorithm_for_employee_salaries
```

3. Создание виртуального окружения

```bash
python3 -m .venv venv
```

4. Активация виртуального окружения

```bash
source .venv/bin/activate
```

5. Установка зависимостей

```bash
pip3 install -r requirements.txt
```
6. Настройка окружения

```bash
cp .env.sample .env
```

7. Запуск приложения

```bash
python3 -m app.main
```
**Документация API будет доступна:**

- Swagger UI: http://localhost:8000/docs
- ReDoc: http://localhost:8000/redoc

## Требования
**Язык программирования**: Python 3.12

**Фреймворк**: FastAPI

**База данных**: MongoDB

**Библиотеки**: Motor для асинхронной работы с MongoDB, aiogram для взаимодействия с Telegram-ботом

## Telegram Bot

### Команды бота:
- `/start` — Приветствие
- `/help` — Подсказка о том, как начать работу
- **"Информация о зарплате"** — Получить агрегированные данные о зарплатах

### Workflow:
1. Пользователь выбирает тип группировки (`month`/`day`/`hour`)
2. Бот запрашивает:
   - Начало периода (например, `2022-09-01T00:00:00`)
   - Конец периода (например, `2022-12-31T23:59:59`)
3. Бот вызывает API `POST /aggregate` и возвращает результат.

### Пример диалога:
```
User: 
    /start
Bot: 
    Привет!
    Какую информацию нужно подготовить сегодня?
User:
    Информация о зарплате
Bot:
    Выберите тип группировки выплат [month/day/hour]
User:
    month
Bot:
    Введите начало периода в формате 2022-09-01T00:00:00
User:
    2022-09-01T00:00:00
Bot:
    Введите конец периода в формате 2022-12-31T23:59:59
User:
    2022-12-01T00:00:00
Bot:
    Данные: [5906586, 5515874, 5889803, 6092634]
    Метки: ['2022-09-01T00:00:00', '2022-10-01T00:00:00', '2022-11-01T00:00:00', '2022-12-01T00:00:00']
```

## Структура проекта

```markdown
.
├── app/
│ ├── init.py
│ ├── database.py # Подключение к MongoDB
│ ├── handlers.py # Логика Telegram бота
│ ├── keyboards.py # Клавиатуры для бота
│ ├── models.py # Pydantic модели и StatesGroup
│ ├── routers/
│ │ └── salaries.py # Эндпоинты FastAPI
│ ├── tests/
│ │ ├── test_api.py # Тестирование эндпоинтов
│ │ └── test_handlers.py # Тестирование ручек бота
│ ├── services.py # Бизнес-логика
│ ├── validators.py # Валидация формата даты
│ └── main.py # Точка входа
├── requirements.txt # Зависимости
├── .env.sample # Переменные окружения
├── .flake8 # Настройка flake8
├── .gitignore # Игнорируемые файлы
└── README.md # Этот файл
```

## Проблемы при использовании проекта

- Если бот не отвечает:
  - Проверьте токен в .env
  - Убедитесь, что сервер API запущен

- При ошибках формата даты:
  - Используйте строго ISO формат: YYYY-MM-DDTHH:MM:SS